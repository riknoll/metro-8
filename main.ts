namespace SpriteKind {
    export const Door = SpriteKind.create()
    export const Effect = SpriteKind.create()
    export const TestSprite = SpriteKind.create()
    export const ReloadSprite = SpriteKind.create()
    export const OpenDoor = SpriteKind.create()
    export const EntranceDoor = SpriteKind.create()
}
namespace myTiles {
    //% blockIdentity=images._tile
    export const tile0 = img`
        . . . . . . . .
        . . . . . . . .
        . . . . . . . .
        . . . . . . . .
        . . . . . . . .
        . . . . . . . .
        . . . . . . . .
        . . . . . . . .
    `
    //% blockIdentity=images._tile
    export const tile1 = img`
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
    `
    //% blockIdentity=images._tile
    export const tile2 = img`
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
        1 1 1 1 1 1 1 1
    `
    //% blockIdentity=images._tile
    export const tile3 = img`
        f 1 f 1 1 1 1 1
        f f f f f f f f
        f 1 1 1 1 f 1 1
        f 1 1 1 1 f 1 1
        f f f f f f f f
        f 1 1 1 f 1 1 1
        f 1 1 1 f 1 1 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile4 = img`
        f f f f f f f 1
        f f f f f f 1 f
        f f f f f 1 f f
        f f f f f f f f
        f f 1 1 1 f f f
        f 1 1 1 1 1 f f
        1 1 1 1 1 1 1 f
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile5 = img`
        f f f f f f f f
        f f f f f f f f
        f f f f f f f f
        f f f f f f f f
        f f f f f f f f
        f f f f f f f f
        f f f f f f f f
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile6 = img`
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f 1 1 1 1 1 1 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile7 = img`
        f 1 1 1 1 1 1 1
        f 1 f 1 f f f 1
        f 1 1 1 1 1 1 1
        f 1 f f f 1 f 1
        f 1 1 1 1 1 1 1
        f 1 f 1 f f f 1
        f 1 1 1 1 1 1 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile8 = img`
        f f 1 f 1 f f f
        f f 1 f 1 f f f
        f f 1 f 1 f f f
        f f 1 f 1 f f f
        f f 1 f 1 f f f
        f f 1 f 1 f f f
        f f 1 f 1 f f f
        f f 1 f 1 f f f
    `
    //% blockIdentity=images._tile
    export const tile9 = img`
        f 1 f f f f f 1
        f 1 f f f f f 1
        f f 1 f f f f 1
        f f 1 f f f f 1
        f f f 1 f f f 1
        f f f f 1 f f 1
        f f f f f 1 f 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile10 = img`
        f f f f f f f f
        f f f f f 1 f 1
        f f f f 1 f f 1
        f f f 1 f f f 1
        f f 1 f f 1 f 1
        f f 1 f 1 f f 1
        f 1 f f f f f 1
        f 1 f f f f f 1
    `
    //% blockIdentity=images._tile
    export const tile20 = img`
        f 1 3 3 3 3 3 1
        f 1 3 3 3 3 3 1
        f f 1 3 3 3 3 1
        f f 1 3 3 3 3 1
        f f f 1 3 3 3 1
        f f f f 1 3 3 1
        f f f f f 1 3 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile23 = img`
        f 1 7 7 7 7 7 1
        f 1 7 7 7 7 7 1
        f f 1 7 7 7 7 1
        f f 1 7 7 7 7 1
        f f f 1 7 7 7 1
        f f f f 1 7 7 1
        f f f f f 1 7 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile24 = img`
        f 1 4 4 4 4 4 1
        f 1 4 4 4 4 4 1
        f f 1 4 4 4 4 1
        f f 1 4 4 4 4 1
        f f f 1 4 4 4 1
        f f f f 1 4 4 1
        f f f f f 1 4 1
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile25 = img`
        1 f f f f f 1 f
        1 f f f f f 1 f
        1 f f f f 1 f f
        1 f f f f 1 f f
        1 f f f 1 f f f
        1 f f 1 f f f f
        1 f 1 f f f f f
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile26 = img`
        f f f f f f f f
        1 f 1 f f f f f
        1 f f 1 f f f f
        1 f f f 1 f f f
        1 f 1 f f 1 f f
        1 f f 1 f 1 f f
        1 f f f f f 1 f
        1 f f f f f 1 f
    `
    //% blockIdentity=images._tile
    export const tile27 = img`
        1 3 3 3 3 3 1 f
        1 3 3 3 3 3 1 f
        1 3 3 3 3 1 f f
        1 3 3 3 3 1 f f
        1 3 3 3 1 f f f
        1 3 3 1 f f f f
        1 3 1 f f f f f
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile28 = img`
        1 7 7 7 7 7 1 f
        1 7 7 7 7 7 1 f
        1 7 7 7 7 1 f f
        1 7 7 7 7 1 f f
        1 7 7 7 1 f f f
        1 7 7 1 f f f f
        1 7 1 f f f f f
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile29 = img`
        1 4 4 4 4 4 1 f
        1 4 4 4 4 4 1 f
        1 4 4 4 4 1 f f
        1 4 4 4 4 1 f f
        1 4 4 4 1 f f f
        1 4 4 1 f f f f
        1 4 1 f f f f f
        f f f f f f f f
    `
    //% blockIdentity=images._tile
    export const tile30 = img`
        f f f 1 f f f f
        f f f f 1 f f f
        f f f 1 1 f f f
        f f f 1 1 f f f
        f f f 1 f f f f
        f f f f 1 f f f
        f f f 1 1 f f f
        f f f 1 1 f f f
    `
}
/**
 * Pink - 0
 * 
 * Green - 1
 * 
 * Orange - 2
 */
function createProjectile () {
    if (controller.down.isPressed()) {
        projectile = sprites.createProjectileFromSprite(img`
            1 1 1
            1 1 1
            1 1 1
            1 1 1
        `, thePlayer, 0, Math.max(thePlayer.vy, 0) + shotSpeed)
        thePlayer.vy = shotRecoilVelocity
    } else if (controller.up.isPressed()) {
        projectile = sprites.createProjectileFromSprite(img`
            1 1 1
            1 1 1
            1 1 1
            1 1 1
        `, thePlayer, 0, Math.min(thePlayer.vy, 0) - shotSpeed)
    } else if (playerIsFacingLeft) {
        projectile = sprites.createProjectileFromSprite(img`
            1 1 1 1
            1 1 1 1
            1 1 1 1
        `, thePlayer, thePlayer.vx - shotSpeed, 0)
    } else {
        projectile = sprites.createProjectileFromSprite(img`
            1 1 1 1
            1 1 1 1
            1 1 1 1
        `, thePlayer, thePlayer.vx + shotSpeed, 0)
    }
    projectile.z = 9
}
function openCloseDoor (open: boolean, door: Sprite) {
    topTile = tiles.getTileLocation(tilemap.screenCoordinateToTile(door.x), tilemap.screenCoordinateToTile(door.y - 4))
    if (open) {
        if (tilemap.tileIs(topTile, myTiles.tile26)) {
            animation.runImageAnimation(
            door,
            [img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f 1 f f f
                1 f 1 f f 1 f f
                1 f f 1 f 1 f f
                1 f f f f f 1 f
                1 f f f f f 1 f
                1 f f f f f 1 f
                1 f f f f f 1 f
                1 f f f f 1 f f
                1 f f f f 1 f f
                1 f f f 1 f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f 1 f f f
                1 f 1 f f 1 f f
                1 f f 1 f 1 f f
                1 f f f f f 1 f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f 1 f
                1 f f f f 1 f f
                1 f f f f 1 f f
                1 f f f 1 f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f 1 f f f
                1 f 1 f f 1 f f
                1 f f 1 f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f 1 f f
                1 f f f 1 f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f f f f f
                1 f 1 f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                f f f f f f f f
            `],
            70,
            false
            )
        } else {
            animation.runImageAnimation(
            door,
            [img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f 1 f f f 1
                f f 1 f f 1 f 1
                f f 1 f 1 f f 1
                f 1 f f f f f 1
                f 1 f f f f f 1
                f 1 f f f f f 1
                f 1 f f f f f 1
                f f 1 f f f f 1
                f f 1 f f f f 1
                f f f 1 f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f 1 f f f 1
                f f 1 f f 1 f 1
                f f 1 f 1 f f 1
                f 1 f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f 1 f f f f f 1
                f f 1 f f f f 1
                f f 1 f f f f 1
                f f f 1 f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f 1 f f f 1
                f f 1 f f 1 f 1
                f f f f 1 f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f 1 f f f f 1
                f f f 1 f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f f
            `],
            70,
            false
            )
        }
        door.setKind(SpriteKind.OpenDoor)
    } else {
        if (tilemap.tileIs(topTile, myTiles.tile26)) {
            animation.runImageAnimation(
            door,
            [img`
                f f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f f f f f
                1 f 1 f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f 1 f f f
                1 f 1 f f 1 f f
                1 f f 1 f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f 1 f f
                1 f f f 1 f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f 1 f f f
                1 f 1 f f 1 f f
                1 f f 1 f 1 f f
                1 f f f f f 1 f
                1 f f f f f f f
                1 f f f f f f f
                1 f f f f f 1 f
                1 f f f f 1 f f
                1 f f f f 1 f f
                1 f f f 1 f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
          `,img`
                f f f f f f f f
                1 f 1 f f f f f
                1 f f 1 f f f f
                1 f f f 1 f f f
                1 f 1 f f 1 f f
                1 f f 1 f 1 f f
                1 f f f f f 1 f
                1 f f f f f 1 f
                1 f f f f f 1 f
                1 f f f f f 1 f
                1 f f f f 1 f f
                1 f f f f 1 f f
                1 f f f 1 f f f
                1 f f 1 f f f f
                1 f 1 f f f f f
                f f f f f f f f
            `],
            70,
            false
            )
        } else {
            animation.runImageAnimation(
            door,
            [img`
                f f f f f f f f
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f 1 f f f 1
                f f 1 f f 1 f 1
                f f f f 1 f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f f 1 f f f f 1
                f f f 1 f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f 1 f f f 1
                f f 1 f f 1 f 1
                f f 1 f 1 f f 1
                f 1 f f f f f 1
                f f f f f f f 1
                f f f f f f f 1
                f 1 f f f f f 1
                f f 1 f f f f 1
                f f 1 f f f f 1
                f f f 1 f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
          `,img`
                f f f f f f f f
                f f f f f 1 f 1
                f f f f 1 f f 1
                f f f 1 f f f 1
                f f 1 f f 1 f 1
                f f 1 f 1 f f 1
                f 1 f f f f f 1
                f 1 f f f f f 1
                f 1 f f f f f 1
                f 1 f f f f f 1
                f f 1 f f f f 1
                f f 1 f f f f 1
                f f f 1 f f f 1
                f f f f 1 f f 1
                f f f f f 1 f 1
                f f f f f f f f
            `],
            70,
            false
            )
        }
        door.setKind(SpriteKind.Door)
    }
    door.setFlag(SpriteFlag.Ghost, !(open) || !(entranceDoorClosed))
    tiles.setWallAt(topTile, !(open))
    tiles.setWallAt(tilemap.locationInDirection(topTile, WorldDirection.South), !(open))
}
function damageBreakableBlock (direction: number, projectile: Sprite) {
    collisionLocation = tilemap.locationInDirection(tilemap.locationOfSprite(projectile), direction)
    for (let value of sprites.allOfKind(SpriteKind.BreakableBlock)) {
        if (tilemap.locationColumn(collisionLocation) == tilemap.screenCoordinateToTile(value.x) && tilemap.locationRow(collisionLocation) == tilemap.screenCoordinateToTile(value.y)) {
            value.setImage(myTiles.tile7)
            tiles.placeOnTile(value, collisionLocation)
            value.z += -1
            if (value.z < 1) {
                value.destroy()
            } else {
                if (direction == WorldDirection.North) {
                    animation.runMovementAnimation(
                    value,
                    "m 0 -1 m 0 1",
                    100,
                    false
                    )
                } else if (direction == WorldDirection.East) {
                    animation.runMovementAnimation(
                    value,
                    "m 1 0 m -1 0",
                    100,
                    false
                    )
                } else if (direction == WorldDirection.South) {
                    animation.runMovementAnimation(
                    value,
                    "m 0 1 m 0 -1",
                    100,
                    false
                    )
                } else {
                    animation.runMovementAnimation(
                    value,
                    "m -1 0 m 1 0",
                    100,
                    false
                    )
                }
            }
        }
    }
}
function updatePlayerFrames () {
    needsUpdate = false
    if (thePlayer.vx != 0) {
        if (!(playerIsMoving)) {
            playerIsMoving = true
            needsUpdate = true
        }
        if (playerIsFacingLeft != thePlayer.vx < 0) {
            playerIsFacingLeft = thePlayer.vx < 0
            needsUpdate = true
        }
    } else if (playerIsMoving) {
        playerIsMoving = false
        needsUpdate = true
    }
    if (needsUpdate) {
        if (playerIsMoving) {
            if (playerIsFacingLeft) {
                animation.runImageAnimation(
                thePlayer,
                [img`
                    . . . . . . . .
                    . 1 1 . . . . .
                    . 1 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . . . .
                    . 1 1 1 1 1 . .
                    . 1 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . . . .
          `,img`
                    . 1 1 . . . . .
                    . 1 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . . 3 3 . . .
                    . . . 3 . . . .
          `,img`
                    . 1 1 . . . . .
                    . 1 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . . 3 3 . . .
                    . . . . 3 . . .
          `,img`
                    . . . . . . . .
                    . . 1 1 . . . .
                    . . 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                `],
                100,
                true
                )
            } else {
                animation.runImageAnimation(
                thePlayer,
                [img`
                    . . . . . . . .
                    . . . . . 1 1 .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . . . .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 1 .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . . . . 3 . .
          `,img`
                    . . . . . 1 1 .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . . 3 3 . . .
                    . . . . 3 . . .
          `,img`
                    . . . . . 1 1 .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . . 3 3 . . .
                    . . . 3 . . . .
          `,img`
                    . . . . . . . .
                    . . . . 1 1 . .
                    . . 1 1 1 1 . .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                `],
                100,
                true
                )
            }
        } else {
            if (playerIsFacingLeft) {
                animation.runImageAnimation(
                thePlayer,
                [img`
                    . . . . . . . .
                    . 1 1 . . . . .
                    . 1 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . . . .
                    . 1 1 1 1 1 . .
                    . 1 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . 1 1 . . . . .
                    . 1 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . 1 1 . . . . .
                    . 1 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . . . .
                    . . 1 1 . . . .
                    . . 1 1 1 1 . .
                    . . 3 3 3 1 . .
                    . . 1 3 1 3 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                `],
                100,
                true
                )
            } else {
                animation.runImageAnimation(
                thePlayer,
                [img`
                    . . . . . . . .
                    . . . . . 1 1 .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . . . .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 1 .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . 1 1 .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . 1 1 .
                    . . 1 1 1 1 1 .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                    . . 3 . . 3 . .
          `,img`
                    . . . . . . . .
                    . . . . 1 1 . .
                    . . 1 1 1 1 . .
                    . . 1 3 3 3 . .
                    . . 3 1 3 1 . .
                    . . 3 3 3 3 . .
                    . . 3 3 3 3 . .
                    . . 3 . . 3 . .
                `],
                100,
                true
                )
            }
        }
    }
    reloadSprite.setPosition(thePlayer.x, thePlayer.bottom - 12)
}
sprites.onCreated(SpriteKind.BreakableBlock, function (sprite) {
    tiles.setWallAt(tilemap.locationOfSprite(sprite), true)
    sprite.setFlag(SpriteFlag.Ghost, true)
    sprite.z = 3
})
function startReloadAnimation () {
    animation.stopAnimation(animation.AnimationTypes.All, reloadSprite)
    animation.runImageAnimation(
    reloadSprite,
    [img`
        3 1 1 1 1 1 1 1
        3 1 1 1 1 1 1 1
    `,img`
        3 3 1 1 1 1 1 1
        3 3 1 1 1 1 1 1
    `,img`
        3 3 3 1 1 1 1 1
        3 3 3 1 1 1 1 1
    `,img`
        3 3 3 3 1 1 1 1
        3 3 3 3 1 1 1 1
    `,img`
        3 3 3 3 3 1 1 1
        3 3 3 3 3 1 1 1
    `,img`
        3 3 3 3 3 3 1 1
        3 3 3 3 3 3 1 1
    `,img`
        3 3 3 3 3 3 3 1
        3 3 3 3 3 3 3 1
    `,img`
        3 3 3 3 3 3 3 3
        3 3 3 3 3 3 3 3
    `,img`
        . . . . . . . .
        . . . . . . . .
    `],
    reloadTime / 9,
    false
    )
    reloadSprite.setPosition(thePlayer.x, thePlayer.bottom - 12)
}
sprites.onCreated(SpriteKind.BrickBlock, function (sprite) {
    if (!(inMapUnload)) {
        tiles.setWallAt(tilemap.locationOfSprite(sprite), true)
        sprite.setImage(myTiles.tile3)
    }
})
sprites.onCreated(SpriteKind.Effect, function (sprite) {
    sprite.z = 10
    sprite.setFlag(SpriteFlag.Ghost, true)
})
sprites.onDestroyed(SpriteKind.BreakableBlock, function (sprite) {
    if (!(inMapUnload)) {
        tiles.setWallAt(tilemap.locationOfSprite(sprite), false)
        tilemap.coverTile(tilemap.locationOfSprite(sprite), myTiles.tile5)
        createExplosion(sprite)
    }
})
overworld.onMapUnloaded(function (map) {
    inMapUnload = true
    tilemap.destorySpritesOfKind(SpriteKind.BreakableBlock)
    tilemap.destorySpritesOfKind(SpriteKind.BrickBlock)
    tilemap.destorySpritesOfKind(SpriteKind.Projectile)
    tilemap.destorySpritesOfKind(SpriteKind.Effect)
    tilemap.destorySpritesOfKind(SpriteKind.OpenDoor)
    tilemap.destorySpritesOfKind(SpriteKind.Door)
    inMapUnload = false
})
scene.onHitWall(SpriteKind.Player, function (sprite) {
    if (sprite.vy < 0) {
        if (sprite.tileKindAt(TileDirection.Top, myTiles.tile3)) {
            collisionLocation = tilemap.locationInDirection(tilemap.locationOfSprite(sprite), WorldDirection.North)
            for (let value of sprites.allOfKind(SpriteKind.BrickBlock)) {
                if (tilemap.locationColumn(collisionLocation) == tilemap.screenCoordinateToTile(value.x) && tilemap.locationRow(collisionLocation) == tilemap.screenCoordinateToTile(value.y)) {
                    animation.stopAnimation(animation.AnimationTypes.All, value)
                    animation.runMovementAnimation(
                    value,
                    "m 0 -1 m 0 1",
                    200,
                    false
                    )
                }
            }
        }
    }
})
sprites.onCreated(SpriteKind.Door, function (sprite) {
    topTile = tilemap.locationOfSprite(sprite)
    bottomTile = tilemap.locationInDirection(topTile, WorldDirection.South)
    sprite.setFlag(SpriteFlag.Ghost, true)
    tiles.setWallAt(tilemap.locationOfSprite(sprite), true)
    tiles.setWallAt(bottomTile, true)
    if (tilemap.tileIs(bottomTile, myTiles.tile20) || tilemap.tileIs(bottomTile, myTiles.tile27)) {
        sprite.z = 1
    } else if (tilemap.tileIs(bottomTile, myTiles.tile23) || tilemap.tileIs(bottomTile, myTiles.tile28)) {
        sprite.z = 2
    } else if (tilemap.tileIs(bottomTile, myTiles.tile24) || tilemap.tileIs(bottomTile, myTiles.tile29)) {
        sprite.z = 3
    }
    if (tilemap.tileIs(topTile, myTiles.tile10)) {
        sprite.setImage(img`
            f f f f f f f f
            f f f f f 1 f 1
            f f f f 1 f f 1
            f f f 1 f f f 1
            f f 1 f f 1 f 1
            f f 1 f 1 f f 1
            f 1 f f f f f 1
            f 1 f f f f f 1
            f 1 f f f f f 1
            f 1 f f f f f 1
            f f 1 f f f f 1
            f f 1 f f f f 1
            f f f 1 f f f 1
            f f f f 1 f f 1
            f f f f f 1 f 1
            f f f f f f f f
        `)
    } else {
        sprite.setImage(img`
            f f f f f f f f
            1 f 1 f f f f f
            1 f f 1 f f f f
            1 f f f 1 f f f
            1 f 1 f f 1 f f
            1 f f 1 f 1 f f
            1 f f f f f 1 f
            1 f f f f f 1 f
            1 f f f f f 1 f
            1 f f f f f 1 f
            1 f f f f 1 f f
            1 f f f f 1 f f
            1 f f f 1 f f f
            1 f f 1 f f f f
            1 f 1 f f f f f
            f f f f f f f f
        `)
    }
})
function testDoorCollision (sprite: Sprite) {
    collisionTestSprite.setPosition(sprite.x, sprite.y)
    if (sprite.vx < 0) {
        if (collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile26) || (collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile27) || collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile28) || collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile29) || collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile25))) {
            openDoor(WorldDirection.West, collisionTestSprite)
        }
    } else if (sprite.vx > 0) {
        if (collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile10) || (collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile20) || collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile23) || collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile24) || collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile9))) {
            openDoor(WorldDirection.East, collisionTestSprite)
        }
    }
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.OpenDoor, function (sprite, otherSprite) {
    entranceDoor = otherSprite.z - 1
    overworld.loadConnectedMap(entranceDoor)
    otherSprite.destroy()
})
function nudgeSprite (sprite: Sprite) {
    nudgeAmount = Math.randomRange(2, 3)
    if (nudgeCounter == 0) {
        sprite.x += nudgeAmount
        sprite.y += nudgeAmount
    } else if (nudgeCounter == 1) {
        sprite.x += 0 - nudgeAmount
        sprite.y += nudgeAmount
    } else if (nudgeCounter == 2) {
        sprite.x += 0 - nudgeAmount
        sprite.y += 0 - nudgeAmount
    } else if (nudgeCounter == 3) {
        sprite.x += nudgeAmount
        sprite.y += 0 - nudgeAmount
    }
    nudgeCounter = (nudgeCounter + 1) % 5
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (thePlayer.isHittingTile(CollisionDirection.Bottom)) {
        thePlayer.vy = playerJumpVelocity
    }
})
scene.onHitWall(SpriteKind.Projectile, function (sprite) {
    testBreakableCollision(sprite)
    testDoorCollision(sprite)
})
function createExplosion (sprite: Sprite) {
    bursts = Math.randomRange(2, 3)
    for (let index = 0; index < bursts; index++) {
        breakEffect = sprites.create(img`
            . . 1 1 1 1 . .
            . 1 1 1 1 1 1 .
            1 1 1 1 1 1 1 1
            1 1 1 1 1 1 1 1
            1 1 1 1 1 1 1 1
            1 1 1 1 1 1 1 1
            . 1 1 1 1 1 1 .
            . . 1 1 1 1 . .
        `, SpriteKind.Effect)
        breakEffect.lifespan = 350
        effectSeed = Math.randomRange(0, 2)
        if (effectSeed == 0) {
            animation.runImageAnimation(
            breakEffect,
            [img`
                . . 1 1 1 1 . .
                . 1 1 1 1 1 1 .
                1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1
                . 1 1 1 1 1 1 .
                . . 1 1 1 1 . .
          `,img`
                . . 1 . 1 1 . .
                . 1 . 1 1 1 1 .
                1 . 1 1 1 1 1 1
                . 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1
                . 1 1 1 1 1 1 .
                . . 1 1 1 1 . .
          `,img`
                . . 1 . 1 . . .
                . 1 . 1 . 1 1 .
                1 . 1 . 1 1 1 1
                . 1 . 1 1 1 1 1
                1 . 1 1 1 1 1 1
                . 1 1 1 1 1 1 1
                . 1 1 1 1 1 1 .
                . . 1 1 1 1 . .
          `,img`
                . . . . 1 . . .
                . . . 1 . 1 . .
                . . 1 . 1 . 1 1
                . 1 . 1 . 1 1 1
                1 . 1 . 1 1 1 1
                . 1 . 1 1 1 1 1
                . . 1 1 1 1 1 .
                . . 1 1 1 1 . .
          `,img`
                . . . . . . . .
                . . . . . 1 . .
                . . . . 1 . 1 .
                . . . 1 . 1 . 1
                . . 1 . 1 . 1 1
                . 1 . 1 . 1 1 1
                . . 1 . 1 1 1 .
                . . . 1 1 1 . .
          `,img`
                . . . . . . . .
                . . . . . . . .
                . . . . . . 1 .
                . . . . . 1 . 1
                . . . . 1 . 1 .
                . . . 1 . 1 . 1
                . . 1 . 1 . 1 .
                . . . 1 . 1 . .
          `,img`
                . . . . . . . .
                . . . . . . . .
                . . . . . . . .
                . . . . . . . 1
                . . . . . . 1 .
                . . . . . 1 . 1
                . . . . 1 . 1 .
                . . . 1 . 1 . .
          `,img`
                . . . . . . . .
                . . . . . . . .
                . . . . . . . .
                . . . . . . . .
                . . . . . . . .
                . . . . . . . 1
                . . . . . . 1 .
                . . . . . 1 . .
            `],
            40,
            false
            )
        } else if (effectSeed == 1) {
            animation.runImageAnimation(
            breakEffect,
            [img`
                . . 1 1 . .
                . 1 1 1 1 .
                1 1 1 1 1 1
                1 1 1 1 1 1
                . 1 1 1 1 .
                . . 1 1 . .
          `,img`
                . . 1 . . .
                . 1 . 1 1 .
                1 . 1 1 1 1
                . 1 1 1 1 1
                . 1 1 1 1 .
                . . 1 1 . .
          `,img`
                . . 1 . . .
                . 1 . 1 . .
                1 . 1 . 1 1
                . 1 . 1 1 1
                . . 1 1 1 .
                . . 1 1 . .
          `,img`
                . . . . . .
                . . . 1 . .
                . . 1 . 1 .
                . 1 . 1 . 1
                . . 1 . 1 .
                . . . 1 . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . 1 .
                . . . 1 . 1
                . . 1 . 1 .
                . . . 1 . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . 1
                . . . . 1 .
                . . . 1 . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
            `],
            40,
            false
            )
        } else {
            animation.runImageAnimation(
            breakEffect,
            [img`
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . .
          `,img`
                . . 1 1 . .
                . 1 1 1 1 .
                1 1 1 1 1 1
                1 1 1 1 1 1
                . 1 1 1 1 .
                . . 1 1 . .
          `,img`
                . . 1 . . .
                . 1 . 1 1 .
                1 . 1 1 1 1
                . 1 1 1 1 1
                . 1 1 1 1 .
                . . 1 1 . .
          `,img`
                . . 1 . . .
                . 1 . 1 . .
                1 . 1 . 1 1
                . 1 . 1 1 1
                . . 1 1 1 .
                . . 1 1 . .
          `,img`
                . . . . . .
                . . . 1 . .
                . . 1 . 1 .
                . 1 . 1 . 1
                . . 1 . 1 .
                . . . 1 . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . 1 .
                . . . 1 . 1
                . . 1 . 1 .
                . . . 1 . .
          `,img`
                . . . . . .
                . . . . . .
                . . . . . .
                . . . . . 1
                . . . . 1 .
                . . . 1 . .
            `],
            40,
            false
            )
        }
        tiles.placeOnTile(breakEffect, tilemap.locationOfSprite(sprite))
        nudgeSprite(breakEffect)
    }
}
function doPlayerControls () {
    currentFrameTime = game.runtime()
    shotTimer += lastFrameTime - currentFrameTime
    if (shotTimer <= 0) {
        if (controller.B.isPressed()) {
            if (shotCount < shotMagazine) {
                shotTimer = shotCooldown
                createProjectile()
                reloadTimer = reloadTime
                if (shotCount == shotMagazine - 1) {
                    startReloadAnimation()
                }
            }
            shotCount += 1
        } else {
            shotTimer = 0
        }
    }
    if (reloadTimer > 0) {
        reloadTimer += lastFrameTime - currentFrameTime
        if (reloadTimer <= 0) {
            shotCount = 0
        }
    }
    lastFrameTime = currentFrameTime
}
function testBreakableCollision (sprite: Sprite) {
    if (sprite.vx < 0) {
        collisionTestSprite.setPosition(sprite.x, sprite.top)
        if (collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.West, collisionTestSprite)
        }
        collisionTestSprite.setPosition(sprite.x, sprite.bottom)
        if (collisionTestSprite.tileKindAt(TileDirection.Left, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.West, collisionTestSprite)
        }
    } else if (sprite.vx > 0) {
        collisionTestSprite.setPosition(sprite.x, sprite.top)
        if (collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.East, collisionTestSprite)
        }
        collisionTestSprite.setPosition(sprite.x, sprite.bottom)
        if (collisionTestSprite.tileKindAt(TileDirection.Right, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.East, collisionTestSprite)
        }
    } else if (sprite.vy < 0) {
        collisionTestSprite.setPosition(sprite.left, sprite.y)
        if (collisionTestSprite.tileKindAt(TileDirection.Top, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.North, collisionTestSprite)
        }
        collisionTestSprite.setPosition(sprite.right, sprite.y)
        if (collisionTestSprite.tileKindAt(TileDirection.Top, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.North, collisionTestSprite)
        }
    } else {
        collisionTestSprite.setPosition(sprite.left, sprite.y)
        if (collisionTestSprite.tileKindAt(TileDirection.Bottom, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.South, collisionTestSprite)
        }
        collisionTestSprite.setPosition(sprite.right, sprite.y)
        if (collisionTestSprite.tileKindAt(TileDirection.Bottom, myTiles.tile7)) {
            damageBreakableBlock(WorldDirection.South, collisionTestSprite)
        }
    }
}
overworld.onMapLoaded(function (map) {
    tilemap.createSpritesOnTiles(myTiles.tile7, SpriteKind.BreakableBlock)
    tilemap.createSpritesOnTiles(myTiles.tile3, SpriteKind.BrickBlock)
    tilemap.createSpritesOnTiles(myTiles.tile10, SpriteKind.Door)
    tilemap.createSpritesOnTiles(myTiles.tile26, SpriteKind.Door)
    for (let value of sprites.allOfKind(SpriteKind.Door)) {
        value.y += 4
        if (value.z == entranceDoor + 1) {
            entranceDoorClosed = false
            openCloseDoor(true, value)
            thePlayer.setPosition(value.x, value.y)
        }
    }
})
controller.A.onEvent(ControllerButtonEvent.Released, function () {
    if (thePlayer.vy < 0) {
        thePlayer.vy = 0
    }
})
function openDoor (direction: number, projectile: Sprite) {
    collisionLocation = tilemap.locationInDirection(tilemap.locationOfSprite(projectile), direction)
    if (tilemap.tileIs(collisionLocation, myTiles.tile24) || tilemap.tileIs(collisionLocation, myTiles.tile29) || (tilemap.tileIs(collisionLocation, myTiles.tile20) || tilemap.tileIs(collisionLocation, myTiles.tile27) || (tilemap.tileIs(collisionLocation, myTiles.tile23) || tilemap.tileIs(collisionLocation, myTiles.tile28)))) {
        collisionLocation = tilemap.locationInDirection(collisionLocation, WorldDirection.North)
    }
    for (let value of sprites.allOfKind(SpriteKind.Door)) {
        if (tilemap.locationColumn(collisionLocation) == tilemap.screenCoordinateToTile(value.x) && tilemap.locationRow(collisionLocation) == tilemap.screenCoordinateToTile(value.y - 4)) {
            openCloseDoor(true, value)
        }
    }
}
function createTileMaps () {
    overworld.loadMap(overworld.createMap(tiles.createTilemap(
            hex`14000f00020202020202020202020202020202020202020202050505050505050505050505050505050505010f050505050505050505050505050505050505011205050505050505050505050505050505050501020707070707070707070707070505050505050a020707070707070707070707070707050505050c02050505050505050505050505050505050707010205050505050505050505050505050507070701020503050505050505050505050505070707070102050505050505050505050505050707070707010205050505050505050505050507070707070501020202050505050505050505070707070707050a020202050505050505050507070707070707050b02020202020202020202020202020202020202020202020202020202020202020202020202020202`,
            img`
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 . . . . . . . . . . . . . . . . . . 2
                . . . . . . . . . . . . . . . . . . . 2
                . . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . .
                2 . . . . . . . . . . . . . . . . . . .
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 2 2 . . . . . . . . . . . . . . . . .
                2 2 2 . . . . . . . . . . . . . . . . .
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
            `,
            [myTiles.tile0,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile4,myTiles.tile5,myTiles.tile6,myTiles.tile7,myTiles.tile8,myTiles.tile9,myTiles.tile10,myTiles.tile20,myTiles.tile23,myTiles.tile24,myTiles.tile25,myTiles.tile26,myTiles.tile27,myTiles.tile28,myTiles.tile29,myTiles.tile30],
            TileScale.Eight
        )))
    overworld.connectMapById(overworld.getLoadedMap(), overworld.createMap(tiles.createTilemap(
            hex`14000f00020202020202020202020202020202020202020202050505050505050505050505050505050505010f05050505050505050505050505050505050501100505050505050505050505050505050505050102070707070505050505050505050505050505010207070707070505050505050505050505050501020202020707070505050505050505050505050102020202020707070505050505050505050505010202020202020707070505050505050505050501020202020202020707070505050505050505050102020202020202020707070505050505050505010202020202020202020707070505050505050501020202020202020202020707070505050505050102020202020202020202020202020202020202020202020202020202020202020202020202020202`,
            img`
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 . . . . . . . . . . . . . . . . . . 2
                . . . . . . . . . . . . . . . . . . . 2
                . . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 2 2 2 . . . . . . . . . . . . . . . 2
                2 2 2 2 2 . . . . . . . . . . . . . . 2
                2 2 2 2 2 2 . . . . . . . . . . . . . 2
                2 2 2 2 2 2 2 . . . . . . . . . . . . 2
                2 2 2 2 2 2 2 2 . . . . . . . . . . . 2
                2 2 2 2 2 2 2 2 2 . . . . . . . . . . 2
                2 2 2 2 2 2 2 2 2 2 . . . . . . . . . 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
            `,
            [myTiles.tile0,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile4,myTiles.tile5,myTiles.tile6,myTiles.tile7,myTiles.tile8,myTiles.tile9,myTiles.tile10,myTiles.tile20,myTiles.tile23,myTiles.tile24,myTiles.tile25,myTiles.tile26,myTiles.tile27,myTiles.tile28,myTiles.tile29,myTiles.tile30],
            TileScale.Eight
        )), 0)
    overworld.connectMapById(overworld.getLoadedMap(), overworld.createMap(tiles.createTilemap(
            hex`14000f00020202020202020202020202020202020202020202050505050505050707070707070707070707010205030503050305070707070707070707070701020505050505050507070707070707070707070102070707070707070707070707070707070707010207070707070707070707070707070707070701020707070707070707070707070707070707070102070707070707070707070707070707070707010207070707070707070707070707070707070701020707070707070707070707070707070707070102070707070707070707070707070707070707010f05050707070707070707070707070707070701110505070707070707070707070707070707070102020202020202020202020202020202020202020202020202020202020202020202020202020202`,
            img`
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                . . . . . . . . . . . . . . . . . . . 2
                . . . . . . . . . . . . . . . . . . . 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
            `,
            [myTiles.tile0,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile4,myTiles.tile5,myTiles.tile6,myTiles.tile7,myTiles.tile8,myTiles.tile9,myTiles.tile10,myTiles.tile20,myTiles.tile23,myTiles.tile24,myTiles.tile25,myTiles.tile26,myTiles.tile27,myTiles.tile28,myTiles.tile29,myTiles.tile30],
            TileScale.Eight
        )), 1)
    overworld.connectMapById(overworld.getLoadedMap(), overworld.createMap(tiles.createTilemap(
            hex`14000f0002020202020202020202020202020202020202020205050505050505050505050505050505050501020505050505050505050505050505050505050a020505050505050505050505050505050505050d02070707070707070707070707070707070707010207070707070707070707070707070707070701020505050505050505050505050505050505050102050505050505050505050505050505050505010205050505050505050505050505050505050501020505050505050505050505050505050505050102050505050505050505050505050505050505010205050505050505050505050505050505050501020505050505050505050505050505050505050102020202020202020202020202020202020202020202020202020202020202020202020202020202`,
            img`
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . .
                2 . . . . . . . . . . . . . . . . . . .
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 . . . . . . . . . . . . . . . . . . 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
                2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
            `,
            [myTiles.tile0,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile4,myTiles.tile5,myTiles.tile6,myTiles.tile7,myTiles.tile8,myTiles.tile9,myTiles.tile10,myTiles.tile20,myTiles.tile23,myTiles.tile24,myTiles.tile25,myTiles.tile26,myTiles.tile27,myTiles.tile28,myTiles.tile29,myTiles.tile30],
            TileScale.Eight
        )), 2)
}
let reloadTimer = 0
let shotCount = 0
let lastFrameTime = 0
let shotTimer = 0
let currentFrameTime = 0
let effectSeed = 0
let breakEffect: Sprite = null
let bursts = 0
let nudgeCounter = 0
let nudgeAmount = 0
let bottomTile: tiles.Location = null
let inMapUnload = false
let needsUpdate = false
let collisionLocation: tiles.Location = null
let topTile: tiles.Location = null
let projectile: Sprite = null
let playerIsFacingLeft = false
let entranceDoorClosed = false
let entranceDoor = 0
let reloadSprite: Sprite = null
let collisionTestSprite: Sprite = null
let shotMagazine = 0
let shotRecoilVelocity = 0
let playerJumpVelocity = 0
let shotSpeed = 0
let reloadTime = 0
let shotCooldown = 0
let playerIsMoving = false
let thePlayer: Sprite = null
thePlayer = sprites.create(img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`, SpriteKind.Player)
controller.moveSprite(thePlayer, 50, 0)
playerIsMoving = true
let gravity = 200
shotCooldown = 100
reloadTime = 750
shotSpeed = 100
let playerJumpHeight = 16
playerJumpVelocity = 0 - Math.sqrt(2 * (gravity * playerJumpHeight))
let shotRecoilHeight = 1
shotRecoilVelocity = 0 - Math.sqrt(2 * (gravity * shotRecoilHeight))
shotMagazine = 10
thePlayer.ay = gravity
thePlayer.z = 9
scene.cameraFollowSprite(thePlayer)
createTileMaps()
collisionTestSprite = sprites.create(img`
    .
`, SpriteKind.TestSprite)
collisionTestSprite.setFlag(SpriteFlag.Ghost, true)
collisionTestSprite.setFlag(SpriteFlag.Invisible, true)
reloadSprite = sprites.create(img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`, SpriteKind.ReloadSprite)
entranceDoor = -5
entranceDoorClosed = true
game.onUpdate(function () {
    updatePlayerFrames()
    doPlayerControls()
    if (!(entranceDoorClosed) && thePlayer.tileKindAt(TileDirection.Center, myTiles.tile5)) {
        entranceDoorClosed = true
        for (let value of sprites.allOfKind(SpriteKind.OpenDoor)) {
            openCloseDoor(false, value)
        }
    }
})
